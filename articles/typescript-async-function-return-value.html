<html><head><meta http-equiv="content-type" content="text/html;charset=utf-8"/><title>TypeScript: `ReturnType` for `async` `function`s | Timm Preetz</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/><link rel="stylesheet" href="/assets/highlightjs.css"/><link rel="alternate" type="application/rss+xml" title="Timm Preetz&#x27;s blog" href="/rss.xml"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png"/><link rel="manifest" href="/assets/favicon/site.webmanifest"/></head><body><div id="navWrapper"><nav><a href="/"><img src="/assets/timm_head_ava.jpg" width="30" height="30" class="headerImage"/><div class="name">Timm Preetz</div></a><div><a href="/projects">Projects</a><a href="/archive">Archive</a><a href="/about">About</a></div></nav></div><div id="mainWrapper" class="grt"><div class="contentWrapper"><div><h1>TypeScript: <code>ReturnType</code> for <code>async</code> <code>function</code>s</h1>
<p>Since the introduction of the <code>ReturnType</code> in <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html">TypeScript 2.8</a>, we can build up types based on the results of functions, without mentioning the types explicitly:</p>
<pre><code class="language-ts"><span class="token keyword">function</span> createContext<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>configProvider<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> config<span class="token punctuation">:</span> ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">}</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        config<span class="token punctuation">:</span> <span class="token function">configProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">apiConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        endpoint<span class="token punctuation">:</span> <span class="token string">'https://www.example.com'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * context has type `{ config: { endpoint: string; }; }`
 */</span>
<span class="token keyword">const</span> context <span class="token operator">=</span>  <span class="token function">createContext</span><span class="token punctuation">(</span>apiConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><a href="https://www.typescriptlang.org/play/#src=%0D%0A%0D%0Afunction%20createContext%3CT%20extends%20()%20%3D%3E%20any%3E(configProvider%3A%20T)%3A%20%7B%20config%3A%20ReturnType%3CT%3E%20%7D%20%7B%0D%0A%20%20%20%20return%20%7B%0D%0A%20%20%20%20%20%20%20%20config%3A%20configProvider()%2C%0D%0A%20%20%20%20%7D%0D%0A%7D%0D%0A%0D%0Afunction%20apiConfig()%20%7B%0D%0A%20%20%20%20return%20%7B%0D%0A%20%20%20%20%20%20%20%20endpoint%3A%20'https%3A%2F%2Fwww.example.com'%0D%0A%20%20%20%20%7D%0D%0A%7D%0D%0A%0D%0A%2F**%0D%0A%20*%20context%20has%20type%20%60%7B%20config%3A%20%7B%20endpoint%3A%20string%3B%20%7D%3B%20%7D%60%0D%0A%20*%2F%0D%0Aconst%20context%20%3D%20%20createContext(apiConfig)">Playground</a></p>
<p>Now that <code>async</code> functions are becoming more prevalent in the code I work with, I have been wondering whether a similar helper can be employed to get the type of a successfully resolved <code>Promise</code>.</p>
<p>As a first building block I wrote a type to extract the <code>Promise</code>'s resolved type:</p>
<pre><code class="language-ts"><span class="token keyword">type</span> PromiseResolvedType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>infer <span class="token constant">R</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// Type is currently Promise&lt;number></span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// value has type `number`, will stay in sync with type of `promise` variable</span>
<span class="token keyword">let</span> comparisionValue<span class="token punctuation">:</span> PromiseResolvedType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> promise<span class="token operator">></span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Value equal to comparison?`</span></span><span class="token punctuation">,</span> value <span class="token operator">===</span> comparisionValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><a href="https://www.typescriptlang.org/play/#src=type%20PromiseResolvedType%3CT%3E%20%3D%20T%20extends%20Promise%3Cinfer%20R%3E%20%3F%20R%20%3A%20never%3B%0D%0A%0D%0A%2F%2F%20Type%20is%20currently%20Promise%3Cnumber%3E%0D%0Aconst%20promise%20%3D%20Promise.resolve(3)%3B%0D%0A%0D%0A%2F%2F%20value%20has%20type%20%60number%60%2C%20will%20stay%20in%20sync%20with%20%60promise%60%20variable%0D%0Alet%20comparisionValue%3A%20PromiseResolvedType%3Ctypeof%20promise%3E%20%3D%205%3B%0D%0A%0D%0Apromise.then(value%20%3D%3E%20console.log(%60Value%20equal%20to%20comparison%3F%60%2C%20value%20%3D%3D%3D%20comparisionValue))%3B">Playground</a></p>
<p>That works nicely to limit our comparision value to the same type as the <code>Promise</code> instance might eventually resolve to. That way we can ensure consistency. If the types were not matching, the comparison will definitely fail, so we get faster feedback by moving that first check to the compile time of the program.</p>
<p>The final step is now to return the <code>ReturnType</code> with the <code>PromiseResolvedType</code> to access the success value of a Promise returned by a function:</p>
<pre><code class="language-ts"><span class="token keyword">type</span> PromiseResolvedType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>infer <span class="token constant">R</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> ReturnedPromiseResolvedType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> PromiseResolvedType<span class="token operator">&lt;</span>ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span>
<span class="token comment">// or flattened: type ReturnedPromiseResolvedType&lt;T> = T extends (...args: any[]) => Promise&lt;infer R> ? R : never;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> RandomFuncResolvedType <span class="token operator">=</span> ReturnedPromiseResolvedType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> random<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// number</span>
</code></pre>
<p><a href="https://www.typescriptlang.org/play/#src=type%20PromiseResolvedType%3CT%3E%20%3D%20T%20extends%20Promise%3Cinfer%20R%3E%20%3F%20R%20%3A%20never%3B%0D%0Atype%20ReturnedPromiseResolvedType%3CT%3E%20%3D%20PromiseResolvedType%3CReturnType%3CT%3E%3E%0D%0A%2F%2F%20or%20flattened%3A%20type%20ReturnedPromiseResolvedType%3CT%3E%20%3D%20T%20extends%20(...args%3A%20any%5B%5D)%20%3D%3E%20Promise%3Cinfer%20R%3E%20%3F%20R%20%3A%20never%3B%0D%0A%0D%0Aasync%20function%20random()%3A%20Promise%3Cnumber%3E%20%7B%0D%0A%20%20return%20Math.random()%3B%0D%0A%7D%0D%0A%0D%0Atype%20RandomFuncResolvedType%20%3D%20ReturnedPromiseResolvedType%3Ctypeof%20random%3E%3B%20%2F%2F%20number">Playground</a></p>
</div></div></div></body></html>